# 📖 使用说明

## 🚀 快速开始

### 1. 首次配置

1. **访问应用**
   - 打开浏览器访问：http://localhost:1338
   - 首次访问会看到默认的血糖监控界面

2. **配置 Nightscout 连接**
   - 点击右上角的 "配置" 按钮
   - 在 "Nightscout 配置" 部分填写：
     - **API 地址**：您的 Nightscout 网站地址（如：https://your-site.herokuapp.com）
     - **时区偏移**：相对于 UTC 的小时数（中国为 +8）
   - 点击 "测试 Nightscout 连接" 验证配置

3. **保存配置**
   - 点击 "保存配置" 按钮
   - 系统会自动验证并保存配置

### 2. 查看血糖数据

1. **主页面功能**
   - **控制面板**：选择查看时间范围（1-30天）
   - **统计卡片**：显示平均血糖、目标范围内比例等
   - **趋势图表**：可视化血糖变化趋势
   - **数据表格**：详细的血糖数据列表

2. **数据同步**
   - 点击右上角的 "同步数据" 按钮
   - 系统会从 Nightscout 获取最新数据
   - 同步完成后会显示获取的数据条数

## 🤖 AI 分析功能

### 1. 配置 AI 服务

**使用 Ollama（推荐）**
```bash
# 启动 Ollama 服务
docker-compose up -d ollama

# 下载模型（首次使用）
docker exec -it nightscout-ollama ollama pull llama3.1:8b
```

**配置参数**
- **API 地址**：`http://localhost:11434/v1/chat/completions`
- **模型名称**：`llama3.1:8b`
- **API 密钥**：留空（Ollama 不需要）

**使用 OpenAI**
- **API 地址**：`https://api.openai.com/v1/chat/completions`
- **模型名称**：`gpt-3.5-turbo` 或 `gpt-4`
- **API 密钥**：您的 OpenAI API 密钥

### 2. 获取 AI 分析

1. **手动分析**
   - 在主页面点击 "AI分析" 按钮
   - 系统会分析当前时间范围的血糖数据
   - 分析结果会在弹窗中显示

2. **自动分析**
   - 在配置页面启用 "定时分析"
   - 设置分析时间点（如：10:00, 15:00, 21:00）
   - 系统会在指定时间自动进行分析

## 📧 邮件通知配置

### 1. SMTP 配置

**Gmail 示例**
- **SMTP 服务器**：`smtp.gmail.com`
- **端口**：`587`
- **用户名**：您的 Gmail 地址
- **密码**：应用专用密码（不是登录密码）
- **发件人**：您的 Gmail 地址
- **收件人**：接收通知的邮箱地址

**QQ 邮箱示例**
- **SMTP 服务器**：`smtp.qq.com`
- **端口**：`587`
- **用户名**：您的 QQ 邮箱
- **密码**：授权码（不是登录密码）

### 2. 测试邮件配置

1. 填写完整的邮件配置
2. 点击 "测试邮件配置" 按钮
3. 系统会发送测试邮件
4. 检查收件箱确认配置正确

## 🔔 通知功能

### 1. 浏览器通知

1. **订阅通知**
   - 点击右上角的 "订阅通知" 按钮
   - 浏览器会请求通知权限
   - 允许权限后即可接收通知

2. **通知类型**
   - 连接状态通知
   - 数据同步通知
   - AI 分析完成通知

### 2. PWA 安装

**桌面安装**
1. 在 Chrome/Edge 中访问应用
2. 地址栏右侧会出现安装图标
3. 点击安装即可添加到桌面

**移动设备安装**
1. 在手机浏览器中访问应用
2. iOS Safari：分享 → 添加到主屏幕
3. Android Chrome：菜单 → 安装应用

## ⚙️ 高级配置

### 1. 定时任务

**同步间隔**
- 设置自动同步数据的间隔时间
- 建议设置为 15-30 分钟

**分析时间**
- 设置每日自动分析的时间点
- 可设置多个时间点，用逗号分隔
- 格式：HH:MM（24小时制）

### 2. 数据管理

**数据存储**
- 数据存储在 SQLite 数据库中
- 位置：`./data/nightscout_data.db`
- 支持自动备份和恢复

**数据清理**
- 系统会自动清理过期数据
- 默认保留 90 天的历史数据

## 🛠️ 故障排除

### 1. 连接问题

**Nightscout 连接失败**
- 检查 API 地址是否正确
- 确认 Nightscout 网站可正常访问
- 验证网络连接

**AI 服务连接失败**
- 检查 AI 服务是否运行
- 验证 API 地址和端口
- 确认模型已下载（Ollama）

### 2. 通知问题

**浏览器通知不工作**
- 检查浏览器通知权限
- 确认 Service Worker 已注册
- 生产环境需要 HTTPS

**邮件通知失败**
- 验证 SMTP 配置
- 检查网络连接
- 确认邮箱授权设置

### 3. 性能优化

**数据加载慢**
- 减少查询时间范围
- 检查网络连接速度
- 考虑使用缓存

**内存使用高**
- 重启应用服务
- 清理历史数据
- 调整同步间隔

## 📊 数据说明

### 1. 血糖指标

**目标范围**
- 正常范围：3.9-10.0 mmol/L (70-180 mg/dL)
- 低血糖：< 3.9 mmol/L (< 70 mg/dL)
- 高血糖：> 10.0 mmol/L (> 180 mg/dL)

**变异系数 (CV)**
- ≤ 36%：血糖波动良好
- 36-50%：血糖波动一般
- > 50%：血糖波动较大

**糖化血红蛋白估算**
- < 5.7%：正常范围
- 5.7-6.4%：糖尿病前期
- ≥ 6.5%：糖尿病

### 2. 趋势箭头

- `→`：平稳
- `↗`：缓慢上升
- `↑`：快速上升
- `↑↑`：非常快速上升
- `↘`：缓慢下降
- `↓`：快速下降
- `↓↓`：非常快速下降

## 🔒 安全建议

1. **网络安全**
   - 生产环境使用 HTTPS
   - 设置强密码
   - 定期更新应用

2. **数据隐私**
   - 定期备份数据
   - 保护配置文件
   - 谨慎分享数据

3. **访问控制**
   - 限制网络访问
   - 使用防火墙
   - 监控访问日志

---

**💡 提示**：如有其他问题，请查看 [README.md](README.md) 或提交 Issue。
